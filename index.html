<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>LaxKeeper - Lacrosse Stats Tracker</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div id="app">
        <!-- Sign-In Screen -->
        <div id="signin-screen" class="screen active">
            <div class="signin-container">
                <img src="logo.png" alt="Mount Si Wildcats Lacrosse" class="signin-logo">
                <h1 class="signin-title">LaxKeeper</h1>
                <p class="signin-subtitle">Lacrosse Stats Tracker</p>
                <button id="google-signin-btn" class="google-signin-btn" onclick="signInWithGoogle()">
                    <svg width="20" height="20" viewBox="0 0 48 48">
                        <path fill="#EA4335" d="M24 9.5c3.54 0 6.71 1.22 9.21 3.6l6.85-6.85C35.9 2.38 30.47 0 24 0 14.62 0 6.51 5.38 2.56 13.22l7.98 6.19C12.43 13.72 17.74 9.5 24 9.5z"/>
                        <path fill="#4285F4" d="M46.98 24.55c0-1.57-.15-3.09-.38-4.55H24v9.02h12.94c-.58 2.96-2.26 5.48-4.78 7.18l7.73 6c4.51-4.18 7.09-10.36 7.09-17.65z"/>
                        <path fill="#FBBC05" d="M10.53 28.59c-.48-1.45-.76-2.99-.76-4.59s.27-3.14.76-4.59l-7.98-6.19C.92 16.46 0 20.12 0 24c0 3.88.92 7.54 2.56 10.78l7.97-6.19z"/>
                        <path fill="#34A853" d="M24 48c6.48 0 11.93-2.13 15.89-5.81l-7.73-6c-2.15 1.45-4.92 2.3-8.16 2.3-6.26 0-11.57-4.22-13.47-9.91l-7.98 6.19C6.51 42.62 14.62 48 24 48z"/>
                    </svg>
                    Sign in with Google
                </button>
                <p class="signin-note">Sign in to sync your data across devices and manage multiple teams.</p>
            </div>
        </div>

        <!-- Home Screen -->
        <div id="home-screen" class="screen">
            <header>
                <h1>ü•ç LaxKeeper</h1>
                <p id="active-team-display" class="active-team-badge"></p>
            </header>

            <nav class="main-nav">
                <button class="nav-btn" onclick="showScreen('roster-screen')">
                    <span class="icon">üë•</span>
                    <span>Manage Roster</span>
                </button>
                <button class="nav-btn" onclick="showScreen('schedule-screen')">
                    <span class="icon">üìÖ</span>
                    <span>Schedule Game</span>
                </button>
                <button class="nav-btn" onclick="showScreen('games-screen')">
                    <span class="icon">üéÆ</span>
                    <span>Start Game</span>
                </button>
                <button class="nav-btn" onclick="showScreen('history-screen')">
                    <span class="icon">üìä</span>
                    <span>Game History</span>
                </button>
                <button class="nav-btn" onclick="showScreen('season-summary-screen')">
                    <span class="icon">üìà</span>
                    <span>Season Summary</span>
                </button>
                <button class="nav-btn" onclick="showScreen('settings-screen')">
                    <span class="icon">‚öôÔ∏è</span>
                    <span>Settings</span>
                </button>
            </nav>
        </div>

        <!-- Roster Management Screen -->
        <div id="roster-screen" class="screen">
            <header>
                <button class="back-btn" onclick="showScreen('home-screen')">‚Üê Back</button>
                <h2>Manage Roster</h2>
            </header>

            <div class="content">
                <div class="add-player-form">
                    <h3>Add Player</h3>
                    <input type="text" id="player-name" placeholder="Player Name" class="input-field">
                    <input type="number" id="player-number" placeholder="Jersey #" class="input-field">
                    <select id="player-position" class="input-field">
                        <option value="">Select Position</option>
                        <option value="Attack">Attack</option>
                        <option value="Midfield">Midfield</option>
                        <option value="Defense">Defense</option>
                        <option value="Goalie">Goalie</option>
                    </select>
                    <button class="btn-primary" onclick="addPlayer()">Add Player</button>
                </div>

                <div class="roster-list">
                    <h3>Current Roster</h3>
                    <div id="roster-display"></div>
                </div>
            </div>
        </div>

        <!-- Schedule Game Screen -->
        <div id="schedule-screen" class="screen">
            <header>
                <button class="back-btn" onclick="showScreen('home-screen')">‚Üê Back</button>
                <h2>Schedule Game</h2>
            </header>

            <div class="content">
                <div class="game-form">
                    <input type="text" id="opponent-name" placeholder="Opponent Name" class="input-field">

                    <label style="color: var(--text-primary); font-weight: 600; margin-bottom: 0.5rem; display: block;">Game Date</label>
                    <input type="date" id="game-date" class="input-field">

                    <label style="color: var(--text-primary); font-weight: 600; margin-bottom: 0.5rem; display: block;">Game Time</label>
                    <input type="time" id="game-time" class="input-field">

                    <input type="text" id="game-location" placeholder="Location" class="input-field">

                    <h3>Game Format</h3>
                    <div class="radio-group">
                        <label>
                            <input type="radio" name="game-format" value="quarters" checked>
                            Quarters (4 periods)
                        </label>
                        <label>
                            <input type="radio" name="game-format" value="halves">
                            Halves (2 periods)
                        </label>
                    </div>

                    <label>Period Duration (minutes):</label>
                    <input type="number" id="period-duration" value="12" min="1" max="30" class="input-field">

                    <button class="btn-primary" onclick="scheduleGame()">Schedule Game</button>
                </div>

                <div class="scheduled-games">
                    <h3>Scheduled Games</h3>
                    <div id="scheduled-games-list"></div>
                </div>
            </div>
        </div>

        <!-- Games List Screen -->
        <div id="games-screen" class="screen">
            <header>
                <button class="back-btn" onclick="showScreen('home-screen')">‚Üê Back</button>
                <h2>Start a Game</h2>
            </header>

            <div class="content">
                <div id="games-list"></div>
            </div>
        </div>

        <!-- Live Game Screen -->
        <div id="game-screen" class="screen">
            <header class="game-header">
                <div id="game-info"></div>
            </header>

            <div class="scoreboard">
                <!-- Clock Control Button (left) -->
                <button class="clock-control-btn" id="left-clock-btn" onclick="toggleClock()">
                    <span id="left-clock-btn-text">START</span>
                </button>

                <div class="team home-team">
                    <h3>Home</h3>
                    <div class="score" id="home-score">0</div>
                    <button class="score-btn" onclick="adjustScore('home', 1)">+</button>
                    <button class="score-btn" onclick="adjustScore('home', -1)">-</button>
                </div>

                <div class="clock-container">
                    <div class="period" id="period-display">Q1</div>
                    <div class="clock" id="game-clock">12:00</div>
                    <div class="clock-controls">
                        <button class="btn-secondary" onclick="toggleClock()">
                            <span id="clock-btn-text">Start</span>
                        </button>
                        <button class="btn-secondary" onclick="resetClock()">Reset</button>
                    </div>
                    <button class="btn-primary" onclick="nextPeriod()">Next Period</button>

                    <!-- Penalty Display -->
                    <div id="penalty-display" style="margin-top: 1rem; width: 100%;"></div>
                </div>

                <div class="team away-team">
                    <h3 id="opponent-display">Opponent</h3>
                    <div class="score" id="away-score">0</div>
                    <button class="score-btn" onclick="adjustScore('away', 1)">+</button>
                    <button class="score-btn" onclick="adjustScore('away', -1)">-</button>
                </div>

                <!-- Voice Input Button (right) -->
                <button id="voice-mic-btn" class="voice-mic-btn" onclick="toggleVoiceInput()" aria-label="Voice input">
                    <svg width="28" height="28" viewBox="0 0 24 24" fill="white">
                        <path d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3z"/>
                        <path d="M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z"/>
                    </svg>
                    <span class="voice-mic-label">VOICE</span>
                </button>
            </div>

            <div class="stats-entry">
                <h3>Select Stat to Record</h3>
                <div id="stat-buttons" class="stat-buttons">
                    <div class="stat-grid">
                        <button class="stat-btn" onclick="selectStat('faceoff-won')">Faceoff Won</button>
                        <button class="stat-btn" onclick="selectStat('faceoff-lost')">Faceoff Lost</button>
                        <button class="stat-btn" onclick="selectStat('ground-ball')">Ground Ball</button>
                        <button class="stat-btn" onclick="selectStat('shot')">Shot</button>
                        <button class="stat-btn" onclick="selectStat('goal')">Goal</button>
                        <button class="stat-btn" onclick="selectStat('assist')">Assist</button>
                        <button class="stat-btn" onclick="selectStat('turnover')">Turnover</button>
                        <button class="stat-btn" onclick="selectStat('caused-turnover')">Takeaway</button>
                        <button class="stat-btn" onclick="selectStat('save')">Save (GK)</button>
                        <button class="stat-btn stat-btn-penalty" onclick="selectStat('penalty')">Penalty</button>
                    </div>
                </div>

                <div id="player-selection" class="player-selection hidden">
                    <h3>Select Player for <span id="selected-stat-name"></span></h3>
                    <button class="btn-opponent" onclick="recordOpponentStat()">
                        <span id="opponent-team-name">Opponent</span> Team
                    </button>
                    <div id="player-buttons" class="player-grid"></div>
                    <button class="btn-secondary" onclick="clearStatSelection()">Back to Stats</button>
                </div>
            </div>

            <div class="game-stats-summary">
                <h3>Game Stats</h3>
                <button class="btn-secondary" onclick="toggleStatsView()">View Stats</button>
            </div>

            <div id="voice-feedback" class="voice-feedback hidden">
                <div id="voice-feedback-status">Listening...</div>
                <div id="voice-feedback-transcript"></div>
            </div>

            <div id="undo-toast" class="undo-toast hidden">
                <span id="undo-toast-text"></span>
                <button id="undo-toast-btn" onclick="undoLastVoiceStat()">UNDO</button>
            </div>

            <div style="padding: 2rem 1.5rem; text-align: center;">
                <button class="btn-danger" onclick="confirmEndGame()" style="max-width: 300px; margin: 0 auto;">End Game</button>
            </div>
        </div>

        <!-- Game History Screen -->
        <div id="history-screen" class="screen">
            <header>
                <button class="back-btn" onclick="showScreen('home-screen')">‚Üê Back</button>
                <h2>Game History</h2>
            </header>

            <div class="content">
                <div id="history-list"></div>
            </div>
        </div>

        <!-- Season Summary Screen -->
        <div id="season-summary-screen" class="screen">
            <header>
                <button class="back-btn" onclick="showScreen('home-screen')">‚Üê Back</button>
                <h2>Season Summary</h2>
            </header>

            <div class="content">
                <div id="season-summary-display"></div>
            </div>
        </div>

        <!-- Settings Screen -->
        <div id="settings-screen" class="screen">
            <header>
                <button class="back-btn" onclick="showScreen('home-screen')">‚Üê Back</button>
                <h2>Settings</h2>
            </header>

            <div class="content">
                <!-- Account Section -->
                <div class="settings-section" id="account-section">
                    <h3>Account</h3>
                    <div id="account-info" class="account-info">
                        <div class="account-avatar" id="account-avatar"></div>
                        <div class="account-details">
                            <div class="account-name" id="account-name">--</div>
                            <div class="account-email" id="account-email">--</div>
                        </div>
                    </div>
                    <button class="btn-secondary" onclick="signOutUser()" style="margin-top: 1rem;">Sign Out</button>
                </div>

                <div class="settings-section">
                    <h3>Team Name</h3>
                    <input type="text" id="team-name" placeholder="Enter team name" class="input-field">
                    <button class="btn-primary" onclick="saveTeamName()">Save Team Name</button>
                </div>

                <div class="settings-section" id="team-sync-section">
                    <h3>My Teams</h3>
                    <!-- Team list (populated by JS) -->
                    <div id="team-list-container"></div>

                    <!-- Create / Join actions -->
                    <div class="team-actions">
                        <button class="btn-primary" onclick="LaxSync.createTeam()">Create Team</button>
                        <div class="sync-divider"><span>or</span></div>
                        <input type="text" id="join-team-code" placeholder="Enter team code"
                               class="input-field" maxlength="6"
                               style="text-transform:uppercase; text-align:center; font-size:1.4rem; letter-spacing:0.3rem;">
                        <button class="btn-secondary" onclick="LaxSync.joinTeam()">Join Team</button>
                    </div>
                </div>

                <div class="settings-section">
                    <h3>Data Management</h3>
                    <button class="btn-secondary" onclick="exportData()">üì• Export Data</button>
                    <button class="btn-secondary" onclick="importData()">üì§ Import Data</button>
                    <input type="file" id="import-file" accept=".json" style="display:none" onchange="handleImport(event)">
                </div>

                <div class="settings-section danger-zone">
                    <h3>Danger Zone</h3>
                    <button class="btn-danger" onclick="clearAllData()">Clear All Data</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/10.14.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.14.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.14.0/firebase-firestore-compat.js"></script>
    <script src="firebase-config.js"></script>
    <script src="firebase-sync.js"></script>
    <script src="app.js"></script>
</body>
</html>
